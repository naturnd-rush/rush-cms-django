import{D as S}from"./utils/events.js";import{a as t,h as T}from"./utils/timing.js";const M=d=>{const l=t(d,".tiled-foreignkey-widget"),e=t(d,".upload-modal"),n=t(e,".icon-file-input"),u=t(e,".preview-container"),b=t(e,".preview-image"),f=t(e,".upload-btn"),p=t(e,".cancel-btn"),c=t(e,".upload-status"),k=t(l,".upload-tile");function E(a){if(l.querySelectorAll(".tile").forEach(s=>s.classList.remove("selected")),this.classList.add("selected"),this.dataset.value!==void 0){const s=t(l,".tiled-fk-select");s.value=this.dataset.value}}function h(){e.style.display="block"}function v(){e.style.display="none",n.value="",u.style.display="none",c.textContent=""}(()=>{const a=T(l,".tile:not(.upload-tile)");for(let s of a)s.addEventListener("click",E);k.addEventListener("click",h),p.addEventListener("click",v)})(),n.addEventListener("change",a=>{if(a.target===null||!(a.target instanceof HTMLInputElement)||!a.target.files)return;const s=a.target.files[0];if(s){const i=new FileReader;i.onload=r=>{r.target===null||r.target.result===null||r.target.result instanceof ArrayBuffer||(b.src=r.target.result,u.style.display="block")},i.readAsDataURL(s)}}),f.addEventListener("click",async()=>{if(n.files===null||n.files[0]==null){c.textContent="Please select a file";return}const a=n.files[0];if(f.disabled)return;const s=t(document,"[name=csrfmiddlewaretoken]").value;c.textContent="Uploading...",f.disabled=!0,p.disabled=!0;try{const i=new FormData;i.append("file",a);const r=await fetch("/rush/icon/ajax-upload/",{method:"POST",headers:{"X-CSRFToken":s},body:i}),m=await r.json();if(r.ok){const o=document.createElement("div");o.className="tile selected",o.dataset.value=m.id,o.innerHTML=`<img src="${m.url}" alt="">`;const w=l.querySelector(".upload-tile");l.insertBefore(o,w);const L=t(l,".tiled-fk-select"),g=document.createElement("option");g.value=m.id,g.selected=!0,L.appendChild(g),l.querySelectorAll(".tile").forEach(y=>y.classList.remove("selected")),o.classList.add("selected"),o.addEventListener("click",()=>{l.querySelectorAll(".tile").forEach(y=>y.classList.remove("selected")),o.classList.add("selected"),o.dataset.value!==void 0&&(L.value=o.dataset.value)}),v()}else c.textContent="Error: "+(m.error||"Upload failed")}catch(i){i instanceof Error?c.textContent="Error: "+i.message:c.textContent="Error: "+String(i)}finally{f.disabled=!1,p.disabled=!1}})};document.addEventListener("DOMContentLoaded",()=>{const d=e=>{const n=e.querySelectorAll(".tiled-foreignkey-widget-container");for(let u of n)u instanceof HTMLElement&&M(u)};new S(document.body).subscribeMutationObserver({childList:!0,subtree:!0},"form",e=>{for(let n of e.addedNodes)n instanceof HTMLElement&&d(n)}),d(document.body)});
