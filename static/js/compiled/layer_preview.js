import{g as me,a as Te}from"./graphql.js";import{l as S,w as Se,e as Ie,g as Le,c as Pe,i as X,b as he}from"./utils.js";var x="INUMBER",B="IOP1",U="IOP2",q="IOP3",b="IVAR",L="IVARNAME",F="IFUNCALL",$="IFUNDEF",M="IEXPR",ee="IEXPREVAL",P="IMEMBER",V="IENDSTATEMENT",D="IARRAY";function f(e,t){this.type=e,this.value=t??0}f.prototype.toString=function(){switch(this.type){case x:case B:case U:case q:case b:case L:case V:return this.value;case F:return"CALL "+this.value;case $:return"DEF "+this.value;case D:return"ARRAY "+this.value;case P:return"."+this.value;default:return"Invalid Instruction"}};function H(e){return new f(B,e)}function T(e){return new f(U,e)}function Ee(e){return new f(q,e)}function Z(e,t,r,n,s){for(var i=[],o=[],a,u,l,p,y=0;y<e.length;y++){var h=e[y],c=h.type;if(c===x||c===L)Array.isArray(h.value)?i.push.apply(i,Z(h.value.map(function(E){return new f(x,E)}).concat(new f(D,h.value.length)),t,r,n,s)):i.push(h);else if(c===b&&s.hasOwnProperty(h.value))h=new f(x,s[h.value]),i.push(h);else if(c===U&&i.length>1)u=i.pop(),a=i.pop(),p=r[h.value],h=new f(x,p(a.value,u.value)),i.push(h);else if(c===q&&i.length>2)l=i.pop(),u=i.pop(),a=i.pop(),h.value==="?"?i.push(a.value?u.value:l.value):(p=n[h.value],h=new f(x,p(a.value,u.value,l.value)),i.push(h));else if(c===B&&i.length>0)a=i.pop(),p=t[h.value],h=new f(x,p(a.value)),i.push(h);else if(c===M){for(;i.length>0;)o.push(i.shift());o.push(new f(M,Z(h.value,t,r,n,s)))}else if(c===P&&i.length>0)a=i.pop(),i.push(new f(x,a.value[h.value]));else{for(;i.length>0;)o.push(i.shift());o.push(h)}}for(;i.length>0;)o.push(i.shift());return o}function Me(e,t,r){for(var n=[],s=0;s<e.length;s++){var i=e[s],o=i.type;if(o===b&&i.value===t)for(var a=0;a<r.tokens.length;a++){var u=r.tokens[a],l;u.type===B?l=H(u.value):u.type===U?l=T(u.value):u.type===q?l=Ee(u.value):l=new f(u.type,u.value),n.push(l)}else o===M?n.push(new f(M,Me(i.value,t,r))):n.push(i)}return n}function I(e,t,r){var n=[],s,i,o,a,u,l;if(te(e))return k(e,r);for(var p=e.length,y=0;y<p;y++){var h=e[y],c=h.type;if(c===x||c===L)n.push(h.value);else if(c===U)i=n.pop(),s=n.pop(),h.value==="and"?n.push(s?!!I(i,t,r):!1):h.value==="or"?n.push(s?!0:!!I(i,t,r)):h.value==="="?(a=t.binaryOps[h.value],n.push(a(s,I(i,t,r),r))):(a=t.binaryOps[h.value],n.push(a(k(s,r),k(i,r))));else if(c===q)o=n.pop(),i=n.pop(),s=n.pop(),h.value==="?"?n.push(I(s?i:o,t,r)):(a=t.ternaryOps[h.value],n.push(a(k(s,r),k(i,r),k(o,r))));else if(c===b)if(h.value in t.functions)n.push(t.functions[h.value]);else if(h.value in t.unaryOps&&t.parser.isOperatorEnabled(h.value))n.push(t.unaryOps[h.value]);else{var E=r[h.value];if(E!==void 0)n.push(E);else throw new Error("undefined variable: "+h.value)}else if(c===B)s=n.pop(),a=t.unaryOps[h.value],n.push(a(k(s,r)));else if(c===F){for(l=h.value,u=[];l-- >0;)u.unshift(k(n.pop(),r));if(a=n.pop(),a.apply&&a.call)n.push(a.apply(void 0,u));else throw new Error(a+" is not a function")}else if(c===$)n.push(function(){for(var O=n.pop(),w=[],ke=h.value;ke-- >0;)w.unshift(n.pop());var ae=n.pop(),W=function(){for(var ue=Object.assign({},r),j=0,be=w.length;j<be;j++)ue[w[j]]=arguments[j];return I(O,t,ue)};return Object.defineProperty(W,"name",{value:ae,writable:!1}),r[ae]=W,W}());else if(c===M)n.push(Ce(h,t));else if(c===ee)n.push(h);else if(c===P)s=n.pop(),n.push(s[h.value]);else if(c===V)n.pop();else if(c===D){for(l=h.value,u=[];l-- >0;)u.unshift(n.pop());n.push(u)}else throw new Error("invalid Expression")}if(n.length>1)throw new Error("invalid Expression (parity)");return n[0]===0?0:k(n[0],r)}function Ce(e,t,r){return te(e)?e:{type:ee,value:function(n){return I(e.value,t,n)}}}function te(e){return e&&e.type===ee}function k(e,t){return te(e)?e.value(t):e}function re(e,t){for(var r=[],n,s,i,o,a,u,l=0;l<e.length;l++){var p=e[l],y=p.type;if(y===x)typeof p.value=="number"&&p.value<0?r.push("("+p.value+")"):Array.isArray(p.value)?r.push("["+p.value.map(pe).join(", ")+"]"):r.push(pe(p.value));else if(y===U)s=r.pop(),n=r.pop(),o=p.value,t?o==="^"?r.push("Math.pow("+n+", "+s+")"):o==="and"?r.push("(!!"+n+" && !!"+s+")"):o==="or"?r.push("(!!"+n+" || !!"+s+")"):o==="||"?r.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+n+"),("+s+")))"):o==="=="?r.push("("+n+" === "+s+")"):o==="!="?r.push("("+n+" !== "+s+")"):o==="["?r.push(n+"[("+s+") | 0]"):r.push("("+n+" "+o+" "+s+")"):o==="["?r.push(n+"["+s+"]"):r.push("("+n+" "+o+" "+s+")");else if(y===q)if(i=r.pop(),s=r.pop(),n=r.pop(),o=p.value,o==="?")r.push("("+n+" ? "+s+" : "+i+")");else throw new Error("invalid Expression");else if(y===b||y===L)r.push(p.value);else if(y===B)n=r.pop(),o=p.value,o==="-"||o==="+"?r.push("("+o+n+")"):t?o==="not"?r.push("(!"+n+")"):o==="!"?r.push("fac("+n+")"):r.push(o+"("+n+")"):o==="!"?r.push("("+n+"!)"):r.push("("+o+" "+n+")");else if(y===F){for(u=p.value,a=[];u-- >0;)a.unshift(r.pop());o=r.pop(),r.push(o+"("+a.join(", ")+")")}else if(y===$){for(s=r.pop(),u=p.value,a=[];u-- >0;)a.unshift(r.pop());n=r.pop(),t?r.push("("+n+" = function("+a.join(", ")+") { return "+s+" })"):r.push("("+n+"("+a.join(", ")+") = "+s+")")}else if(y===P)n=r.pop(),r.push(n+"."+p.value);else if(y===D){for(u=p.value,a=[];u-- >0;)a.unshift(r.pop());r.push("["+a.join(", ")+"]")}else if(y===M)r.push("("+re(p.value,t)+")");else if(y!==V)throw new Error("invalid Expression")}return r.length>1&&(t?r=[r.join(",")]:r=[r.join(";")]),String(r[0])}function pe(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function R(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function ne(e,t,r){r=r||{};for(var n=!!r.withMembers,s=null,i=0;i<e.length;i++){var o=e[i];o.type===b||o.type===L?!n&&!R(t,o.value)?t.push(o.value):(s!==null&&(R(t,s)||t.push(s)),s=o.value):o.type===P&&n&&s!==null?s+="."+o.value:o.type===M?ne(o.value,t,r):s!==null&&(R(t,s)||t.push(s),s=null)}s!==null&&!R(t,s)&&t.push(s)}function A(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}A.prototype.simplify=function(e){return e=e||{},new A(Z(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)};A.prototype.substitute=function(e,t){return t instanceof A||(t=this.parser.parse(String(t))),new A(Me(this.tokens,e,t),this.parser)};A.prototype.evaluate=function(e){return e=e||{},I(this.tokens,this,e)};A.prototype.toString=function(){return re(this.tokens,!1)};A.prototype.symbols=function(e){e=e||{};var t=[];return ne(this.tokens,t,e),t};A.prototype.variables=function(e){e=e||{};var t=[];ne(this.tokens,t,e);var r=this.functions;return t.filter(function(n){return!(n in r)})};A.prototype.toJSFunction=function(e,t){var r=this,n=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+re(this.simplify(t).tokens,!0)+"; }");return function(){return n.apply(r,arguments)}};var G="TEOF",v="TOP",Y="TNUMBER",xe="TSTRING",m="TPAREN",_="TBRACKET",z="TCOMMA",se="TNAME",ie="TSEMICOLON";function Ae(e,t,r){this.type=e,this.value=t,this.index=r}Ae.prototype.toString=function(){return this.type+": "+this.value};function g(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}g.prototype.newToken=function(e,t,r){return new Ae(e,t,r??this.pos)};g.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current};g.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent};g.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(G,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};g.prototype.isString=function(){var e=!1,t=this.pos,r=this.expression.charAt(t);if(r==="'"||r==='"')for(var n=this.expression.indexOf(r,t+1);n>=0&&this.pos<this.expression.length;){if(this.pos=n+1,this.expression.charAt(n-1)!=="\\"){var s=this.expression.substring(t+1,n);this.current=this.newToken(xe,this.unescape(s),t),e=!0;break}n=this.expression.indexOf(r,n+1)}return e};g.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return e==="("||e===")"?(this.current=this.newToken(m,e),this.pos++,!0):!1};g.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return(e==="["||e==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(_,e),this.pos++,!0):!1};g.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return e===","?(this.current=this.newToken(z,","),this.pos++,!0):!1};g.prototype.isSemicolon=function(){var e=this.expression.charAt(this.pos);return e===";"?(this.current=this.newToken(ie,";"),this.pos++,!0):!1};g.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&r!=="."&&(r<"0"||r>"9")))break}if(t>e){var n=this.expression.substring(e,t);if(n in this.consts)return this.current=this.newToken(Y,this.consts[n]),this.pos+=n.length,!0}return!1};g.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&(r<"0"||r>"9")))break}if(t>e){var n=this.expression.substring(e,t);if(this.isOperatorEnabled(n)&&(n in this.binaryOps||n in this.unaryOps||n in this.ternaryOps))return this.current=this.newToken(v,n),this.pos+=n.length,!0}return!1};g.prototype.isName=function(){for(var e=this.pos,t=e,r=!1;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()){if(t===this.pos&&(n==="$"||n==="_")){n==="_"&&(r=!0);continue}else if(t===this.pos||!r||n!=="_"&&(n<"0"||n>"9"))break}else r=!0}if(r){var s=this.expression.substring(e,t);return this.current=this.newToken(se,s),this.pos+=s.length,!0}return!1};g.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(e=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var Ne=/^[0-9a-f]{4}$/i;g.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var r=e.substring(0,t);t>=0;){var n=e.charAt(++t);switch(n){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;case"u":var s=e.substring(t+1,t+5);Ne.test(s)||this.parseError("Illegal escape sequence: \\u"+s),r+=String.fromCharCode(parseInt(s,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+n+'"')}++t;var i=e.indexOf("\\",t);r+=e.substring(t,i<0?e.length:i),t=i}return r};g.prototype.isComment=function(){var e=this.expression.charAt(this.pos);return e==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1};g.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||this.expression.charAt(e)!=="0")return!1;++e;var t,r;if(this.expression.charAt(e)==="x")t=16,r=/^[0-9a-f]$/i,++e;else if(this.expression.charAt(e)==="b")t=2,r=/^[01]$/i,++e;else return!1;for(var n=!1,s=e;e<this.expression.length;){var i=this.expression.charAt(e);if(r.test(i))e++,n=!0;else break}return n&&(this.current=this.newToken(Y,parseInt(this.expression.substring(s,e),t)),this.pos=e),n};g.prototype.isNumber=function(){for(var e=!1,t=this.pos,r=t,n=t,s=!1,i=!1,o;t<this.expression.length&&(o=this.expression.charAt(t),o>="0"&&o<="9"||!s&&o===".");)o==="."?s=!0:i=!0,t++,e=i;if(e&&(n=t),o==="e"||o==="E"){t++;for(var a=!0,u=!1;t<this.expression.length;){if(o=this.expression.charAt(t),a&&(o==="+"||o==="-"))a=!1;else if(o>="0"&&o<="9")u=!0,a=!1;else break;t++}u||(t=n)}return e?(this.current=this.newToken(Y,parseFloat(this.expression.substring(r,t))),this.pos=t):this.pos=n,e};g.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(v,t);else if(t==="∙"||t==="•")this.current=this.newToken(v,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(v,">="),this.pos++):this.current=this.newToken(v,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(v,"<="),this.pos++):this.current=this.newToken(v,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(v,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(v,"=="),this.pos++):this.current=this.newToken(v,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(v,"!="),this.pos++):this.current=this.newToken(v,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=e,!1)};g.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)};g.prototype.getCoordinates=function(){var e=0,t,r=-1;do e++,t=this.pos-r,r=this.expression.indexOf(`
`,r+1);while(r>=0&&r<this.pos);return{line:e,column:t}};g.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)};function d(e,t,r){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=r.allowMemberAccess!==!1}d.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()};d.prototype.tokenMatches=function(e,t){return typeof t>"u"?!0:Array.isArray(t)?R(t,e.value):typeof t=="function"?t(e):e.value===t};d.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()};d.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken};d.prototype.accept=function(e,t){return this.nextToken.type===e&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1};d.prototype.expect=function(e,t){if(!this.accept(e,t)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(t||e))}};d.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;function r(s){return s.value in t}if(this.accept(se)||this.accept(v,r))e.push(new f(b,this.current.value));else if(this.accept(Y))e.push(new f(x,this.current.value));else if(this.accept(xe))e.push(new f(x,this.current.value));else if(this.accept(m,"("))this.parseExpression(e),this.expect(m,")");else if(this.accept(_,"["))if(this.accept(_,"]"))e.push(new f(D,0));else{var n=this.parseArrayList(e);e.push(new f(D,n))}else throw new Error("unexpected "+this.nextToken)};d.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(e,t)&&this.pushExpression(e,t))};d.prototype.pushExpression=function(e,t){for(var r=0,n=t.length;r<n;r++)e.push(t[r])};d.prototype.parseUntilEndStatement=function(e,t){return this.accept(ie)?(this.nextToken&&this.nextToken.type!==G&&!(this.nextToken.type===m&&this.nextToken.value===")")&&t.push(new f(V)),this.nextToken.type!==G&&this.parseExpression(t),e.push(new f(M,t)),!0):!1};d.prototype.parseArrayList=function(e){for(var t=0;!this.accept(_,"]");)for(this.parseExpression(e),++t;this.accept(z);)this.parseExpression(e),++t;return t};d.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(v,"=");){var t=e.pop(),r=[],n=e.length-1;if(t.type===F){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var s=0,i=t.value+1;s<i;s++){var o=n-s;e[o].type===b&&(e[o]=new f(L,e[o].value))}this.parseVariableAssignmentExpression(r),e.push(new f(M,r)),e.push(new f($,t.value));continue}if(t.type!==b&&t.type!==P)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),e.push(new f(L,t.value)),e.push(new f(M,r)),e.push(T("="))}};d.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(v,"?");){var t=[],r=[];this.parseConditionalExpression(t),this.expect(v,":"),this.parseConditionalExpression(r),e.push(new f(M,t)),e.push(new f(M,r)),e.push(Ee("?"))}};d.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(v,"or");){var t=[];this.parseAndExpression(t),e.push(new f(M,t)),e.push(T("or"))}};d.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(v,"and");){var t=[];this.parseComparison(t),e.push(new f(M,t)),e.push(T("and"))}};var Re=["==","!=","<","<=",">=",">","in"];d.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(v,Re);){var t=this.current;this.parseAddSub(e),e.push(T(t.value))}};var Fe=["+","-","||"];d.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(v,Fe);){var t=this.current;this.parseTerm(e),e.push(T(t.value))}};var De=["*","/","%"];d.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(v,De);){var t=this.current;this.parseFactor(e),e.push(T(t.value))}};d.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;function r(s){return s.value in t}if(this.save(),this.accept(v,r)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===m&&this.nextToken.value==="("){this.restore(),this.parseExponential(e);return}else if(this.nextToken.type===ie||this.nextToken.type===z||this.nextToken.type===G||this.nextToken.type===m&&this.nextToken.value===")"){this.restore(),this.parseAtom(e);return}}var n=this.current;this.parseFactor(e),e.push(H(n.value))}else this.parseExponential(e)};d.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(v,"^");)this.parseFactor(e),e.push(T("^"))};d.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(v,"!");)e.push(H("!"))};d.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;function r(i){return i.value in t}if(this.accept(v,r)){var n=this.current;this.parseAtom(e),e.push(H(n.value))}else for(this.parseMemberExpression(e);this.accept(m,"(");)if(this.accept(m,")"))e.push(new f(F,0));else{var s=this.parseArgumentList(e);e.push(new f(F,s))}};d.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(m,")");)for(this.parseExpression(e),++t;this.accept(z);)this.parseExpression(e),++t;return t};d.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(v,".")||this.accept(_,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(se),e.push(new f(P,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(_,"]"),e.push(T("["))}else throw new Error("unexpected symbol: "+t.value)}};function _e(e,t){return Number(e)+Number(t)}function Be(e,t){return e-t}function Ue(e,t){return e*t}function qe(e,t){return e/t}function Ge(e,t){return e%t}function je(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function Je(e,t){return e===t}function $e(e,t){return e!==t}function Ve(e,t){return e>t}function He(e,t){return e<t}function Ye(e,t){return e>=t}function ze(e,t){return e<=t}function We(e,t){return!!(e&&t)}function Xe(e,t){return!!(e||t)}function Ke(e,t){return R(t,e)}function Ze(e){return(Math.exp(e)-Math.exp(-e))/2}function Qe(e){return(Math.exp(e)+Math.exp(-e))/2}function et(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function tt(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function rt(e){return Math.log(e+Math.sqrt(e*e-1))}function nt(e){return Math.log((1+e)/(1-e))/2}function le(e){return Math.log(e)*Math.LOG10E}function st(e){return-e}function it(e){return!e}function ot(e){return e<0?Math.ceil(e):Math.floor(e)}function at(e){return Math.random()*(e||1)}function fe(e){return oe(e+1)}function ut(e){return isFinite(e)&&e===Math.round(e)}var ht=4.7421875,K=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function oe(e){var t,r;if(ut(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var n=e-2,s=e-1;n>1;)s*=n,n--;return s===0&&(s=1),s}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*oe(1-e));if(e>=171.35)return 1/0;if(e>85){var i=e*e,o=i*e,a=o*e,u=a*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*i)-139/(51840*o)-571/(2488320*a)+163879/(209018880*u)+5246819/(75246796800*u*e))}--e,r=K[0];for(var l=1;l<K.length;++l)r+=K[l]/(e+l);return t=e+ht+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*r}function pt(e){return Array.isArray(e)?e.length:String(e).length}function ce(){for(var e=0,t=0,r=0;r<arguments.length;r++){var n=Math.abs(arguments[r]),s;t<n?(s=t/n,e=e*s*s+1,t=n):n>0?(s=n/t,e+=s*s):e+=n}return t===1/0?1/0:t*Math.sqrt(e)}function ye(e,t,r){return e?t:r}function lt(e,t){return typeof t>"u"||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||!(typeof t=="number"&&t%1===0)?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function ft(e,t,r){return r&&(r[e]=t),t}function ct(e,t){return e[t|0]}function yt(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function vt(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function dt(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(r,n){return e(r,n)})}function wt(e,t,r){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce(function(n,s,i){return e(n,s,i)},t)}function gt(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(r,n){return e(r,n)})}function Et(e,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function Mt(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function xt(e){return(e>0)-(e<0)||+e}var ve=1/3;function At(e){return e<0?-Math.pow(-e,ve):Math.pow(e,ve)}function Ot(e){return Math.exp(e)-1}function kt(e){return Math.log(1+e)}function bt(e){return Math.log(e)/Math.LN2}function C(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||Ze,cosh:Math.cosh||Qe,tanh:Math.tanh||et,asinh:Math.asinh||tt,acosh:Math.acosh||rt,atanh:Math.atanh||nt,sqrt:Math.sqrt,cbrt:Math.cbrt||At,log:Math.log,log2:Math.log2||bt,ln:Math.log,lg:Math.log10||le,log10:Math.log10||le,expm1:Math.expm1||Ot,log1p:Math.log1p||kt,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||ot,"-":st,"+":Number,exp:Math.exp,not:it,length:pt,"!":fe,sign:Math.sign||xt},this.binaryOps={"+":_e,"-":Be,"*":Ue,"/":qe,"%":Ge,"^":Math.pow,"||":je,"==":Je,"!=":$e,">":Ve,"<":He,">=":Ye,"<=":ze,and:We,or:Xe,in:Ke,"=":ft,"[":ct},this.ternaryOps={"?":ye},this.functions={random:at,fac:fe,min:vt,max:yt,hypot:Math.hypot||ce,pyt:Math.hypot||ce,pow:Math.pow,atan2:Math.atan2,if:ye,gamma:oe,roundTo:lt,map:dt,fold:wt,filter:gt,indexOf:Et,join:Mt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}C.prototype.parse=function(e){var t=[],r=new d(this,new g(this,e),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(t),r.expect(G,"EOF"),new A(t,this)};C.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var Oe=new C;C.parse=function(e){return Oe.parse(e)};C.evaluate=function(e,t){return Oe.parse(e).evaluate(t)};var de={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function mt(e){return de.hasOwnProperty(e)?de[e]:e}C.prototype.isOperatorEnabled=function(e){var t=mt(e),r=this.options.operators||{};return!(t in r)||!!r[t]};async function J(){var t,r;const e=[];for(let n of document.querySelectorAll("tr[id*='stylesonlayer_set-']")){const s=(t=n.querySelector("select[id*='-style']"))==null?void 0:t.value,i=(r=n.querySelector("textarea[id*='feature_mapping']"))==null?void 0:r.value;if(!(s&&i))continue;const o=await me(s);o!==null&&e.push({style:o,feature_mapping:i,inlineRow:n})}return{type:"Style",newStylesOnLayers:e}}async function we(e){const t={type:"MapData",newGeoJsonData:null},r=e.title;if(r===null||r==="")return t;const n=await Te(r);if(n===null)return t;const s=JSON.parse(n.geojson);return s.features===null||s.features===void 0?t:{type:"MapData",newGeoJsonData:s}}const ge={styles:{addEventListener:e=>{const t=document.getElementById("stylesonlayer_set-group");t!==null&&new MutationObserver(n=>{n.forEach(s=>{s.target instanceof HTMLSelectElement&&s.type==="childList"&&e(s)})}).observe(t,{childList:!0,subtree:!0})}},featureMappings:{addEventListener:e=>{document.addEventListener("input",t=>{const r=t.target;r instanceof HTMLTextAreaElement&&r.id.includes("feature_mapping")&&e(t)})}}};function Q(e,t){const r=new C;let n=[];for(let s of t){const i=s.inlineRow.querySelector("td[class*='feature_mapping']"),o=i==null?void 0:i.querySelector("div[id*='errors']");try{r.parse(s.feature_mapping).evaluate(Pe(e.properties))===!0&&(n.push(s.style),o&&i&&i.removeChild(o))}catch(a){if(o&&i&&i.removeChild(o),i&&!(i!=null&&i.querySelector("div[id*='errors']"))){const u=document.createElement("div");u.textContent=String(a),u.id="errors",u.style="color:rgb(255, 0, 0);",i.insertBefore(u,i.children[0])}}}return n}function Tt(){return{fill:!0,fillColor:"#4B3EFF",fillOpacity:.3,stroke:!0,weight:1,opacity:1,color:"#4B3EFF",dashArray:"1 10",dashOffset:"0",lineCap:"round",lineJoin:"round"}}function St(e){return r=>{if(e.stylesOnLayer.length==0)return Tt();let n=Q(r,e.stylesOnLayer),s=!1,i=!1,o,a,u,l,p,y,h="",c,E="round",O="round";for(let w of n)w.drawFill===!0&&(s=!0),w.drawStroke===!0&&(i=!0),w.drawMarker,o=X(o,w.fillOpacity),a=X(a,w.strokeOpacity),p=X(p,w.strokeWeight),u===void 0?u=w.fillColor:u=he(u,w.fillColor,.5),l===void 0?l=w.strokeColor:l=he(l,w.strokeColor,.5),w.markerIcon!==""&&w.markerIcon,w.strokeDashArray!==null&&(h=w.strokeDashArray),w.strokeDashOffset!==null&&(c=w.strokeDashOffset),O=w.strokeLineJoin,E=w.strokeLineCap;return{fill:s,fillColor:u,fillOpacity:o,stroke:i,weight:p,opacity:a,color:l,dashArray:h,dashOffset:c,lineCap:E,lineJoin:O}}}function N(e,t,r){if(t.currentLayer!==null&&e.removeLayer(t.currentLayer),r.type==="MapData"){const u=r.newGeoJsonData;u===null?t.currentLayer=null:(t.currentLayer=S.geoJSON(u),e.fitBounds(t.currentLayer.getBounds()))}else r.type==="Style"&&(t.stylesOnLayer=r.newStylesOnLayers);if(t.currentLayer===null)return;const n=32,s=26,i=Ie("injected-media-url").innerHTML,o=t.stylesOnLayer.filter(u=>u.style.drawMarker==!0).length>0,a=S.geoJSON(t.currentLayer.toGeoJSON(),{style:St(t),onEachFeature:(u,l)=>{if(u.geometry.type.toUpperCase().includes("POLYGON")&&o){const y=u,c=Q(u,t.stylesOnLayer).filter(E=>E.drawMarker==!0);if(c.length>0){c[0];for(let E of y.geometry.coordinates){const O=Le(E);console.log(O)}}}},pointToLayer:function(u,l){let p=null;const y=Q(u,t.stylesOnLayer);for(let h of y)if(h.drawMarker&&h.markerIcon.trimStart().trimEnd()!==""){p=h;break}return p===null?S.marker(l):S.marker(l,{icon:S.divIcon({html:`
                        <div 
                            style="
                                width: ${n}px;
                                height: ${n}px;
                                background-color: ${p.markerBackgroundColor};
                                opacity: ${p.markerIconOpacity};
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            "
                        >
                            <img 
                                src="${i+p.markerIcon}"
                                style="
                                    width: ${s}px; 
                                    height: ${s}px;
                                "
                            />
                        <div/>
                    `,className:"",iconSize:[n,n],iconAnchor:[n/2,n/2]})})}});t.currentLayer=a,a.addTo(e)}document.addEventListener("DOMContentLoaded",()=>{(async()=>{const e={minZoom:0,maxZoom:22,updateWhenIdle:!0,zIndex:0,attribution:'© <a href="https://www.mapbox.com/about/maps/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>'},t="rushadmin",r="clw2m6f9b018001obfxcc747g",n="pk.eyJ1IjoicnVzaGFkbWluIiwiYSI6ImNsdzJtYmRydzBuNDIyam5yZ2pwMG16cnUifQ.SkSSdHcrPq4u8HSitBvJcg",s="https://api.mapbox.com/styles/v1/",i=`${t}/${r}/tiles/256/{z}/{x}/{y}@2x`,o=`?access_token=${n}`;let a=S.map("map-preview").setView([0,0],2);S.tileLayer(s+i+o,e).addTo(a);let u={stylesOnLayer:[],currentLayer:null},l=!1;ge.featureMappings.addEventListener(()=>l=!0);const p=()=>{l===!0&&J().then(E=>{N(a,u,E)}),l=!1,setTimeout(p,1e3)};setTimeout(p,1e3),ge.styles.addEventListener(()=>{J().then(E=>{N(a,u,E)})}),document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"&&J().then(E=>{N(a,u,E)})});const h=await Se("select2-id_map_data-container");new MutationObserver(E=>{E.forEach(O=>{O.type==="childList"&&we(h).then(w=>N(a,u,w))})}).observe(h,{childList:!0}),Promise.all([J(),we(h)]).then(([E,O])=>{N(a,u,O),N(a,u,E)})})()});
