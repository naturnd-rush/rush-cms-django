import{g as Te,a as Se}from"./graphql.js";import{l as L,w as Ie,e as Le,g as Pe,i as te,b as fe,c as Ce}from"./utils.js";var O="INUMBER",G="IOP1",j="IOP2",J="IOP3",m="IVAR",C="IVARNAME",U="IFUNCALL",X="IFUNDEF",x="IEXPR",ie="IEXPREVAL",N="IMEMBER",K="IENDSTATEMENT",B="IARRAY";function f(e,t){this.type=e,this.value=t??0}f.prototype.toString=function(){switch(this.type){case O:case G:case j:case J:case m:case C:case K:return this.value;case U:return"CALL "+this.value;case X:return"DEF "+this.value;case B:return"ARRAY "+this.value;case N:return"."+this.value;default:return"Invalid Instruction"}};function Z(e){return new f(G,e)}function S(e){return new f(j,e)}function Ae(e){return new f(J,e)}function ne(e,t,r,s,n){for(var i=[],a=[],o,h,p,l,v=0;v<e.length;v++){var u=e[v],c=u.type;if(c===O||c===C)Array.isArray(u.value)?i.push.apply(i,ne(u.value.map(function(g){return new f(O,g)}).concat(new f(B,u.value.length)),t,r,s,n)):i.push(u);else if(c===m&&n.hasOwnProperty(u.value))u=new f(O,n[u.value]),i.push(u);else if(c===j&&i.length>1)h=i.pop(),o=i.pop(),l=r[u.value],u=new f(O,l(o.value,h.value)),i.push(u);else if(c===J&&i.length>2)p=i.pop(),h=i.pop(),o=i.pop(),u.value==="?"?i.push(o.value?h.value:p.value):(l=s[u.value],u=new f(O,l(o.value,h.value,p.value)),i.push(u));else if(c===G&&i.length>0)o=i.pop(),l=t[u.value],u=new f(O,l(o.value)),i.push(u);else if(c===x){for(;i.length>0;)a.push(i.shift());a.push(new f(x,ne(u.value,t,r,s,n)))}else if(c===N&&i.length>0)o=i.pop(),i.push(new f(O,o.value[u.value]));else{for(;i.length>0;)a.push(i.shift());a.push(u)}}for(;i.length>0;)a.push(i.shift());return a}function Oe(e,t,r){for(var s=[],n=0;n<e.length;n++){var i=e[n],a=i.type;if(a===m&&i.value===t)for(var o=0;o<r.tokens.length;o++){var h=r.tokens[o],p;h.type===G?p=Z(h.value):h.type===j?p=S(h.value):h.type===J?p=Ae(h.value):p=new f(h.type,h.value),s.push(p)}else a===x?s.push(new f(x,Oe(i.value,t,r))):s.push(i)}return s}function P(e,t,r){var s=[],n,i,a,o,h,p;if(ae(e))return b(e,r);for(var l=e.length,v=0;v<l;v++){var u=e[v],c=u.type;if(c===O||c===C)s.push(u.value);else if(c===j)i=s.pop(),n=s.pop(),u.value==="and"?s.push(n?!!P(i,t,r):!1):u.value==="or"?s.push(n?!0:!!P(i,t,r)):u.value==="="?(o=t.binaryOps[u.value],s.push(o(n,P(i,t,r),r))):(o=t.binaryOps[u.value],s.push(o(b(n,r),b(i,r))));else if(c===J)a=s.pop(),i=s.pop(),n=s.pop(),u.value==="?"?s.push(P(n?i:a,t,r)):(o=t.ternaryOps[u.value],s.push(o(b(n,r),b(i,r),b(a,r))));else if(c===m)if(u.value in t.functions)s.push(t.functions[u.value]);else if(u.value in t.unaryOps&&t.parser.isOperatorEnabled(u.value))s.push(t.unaryOps[u.value]);else{var g=r[u.value];if(g!==void 0)s.push(g);else throw new Error("undefined variable: "+u.value)}else if(c===G)n=s.pop(),o=t.unaryOps[u.value],s.push(o(b(n,r)));else if(c===U){for(p=u.value,h=[];p-- >0;)h.unshift(b(s.pop(),r));if(o=s.pop(),o.apply&&o.call)s.push(o.apply(void 0,h));else throw new Error(o+" is not a function")}else if(c===X)s.push(function(){for(var M=s.pop(),A=[],$=u.value;$-- >0;)A.unshift(s.pop());var Y=s.pop(),D=function(){for(var V=Object.assign({},r),I=0,z=A.length;I<z;I++)V[A[I]]=arguments[I];return P(M,t,V)};return Object.defineProperty(D,"name",{value:Y,writable:!1}),r[Y]=D,D}());else if(c===x)s.push(Ne(u,t));else if(c===ie)s.push(u);else if(c===N)n=s.pop(),s.push(n[u.value]);else if(c===K)s.pop();else if(c===B){for(p=u.value,h=[];p-- >0;)h.unshift(s.pop());s.push(h)}else throw new Error("invalid Expression")}if(s.length>1)throw new Error("invalid Expression (parity)");return s[0]===0?0:b(s[0],r)}function Ne(e,t,r){return ae(e)?e:{type:ie,value:function(s){return P(e.value,t,s)}}}function ae(e){return e&&e.type===ie}function b(e,t){return ae(e)?e.value(t):e}function oe(e,t){for(var r=[],s,n,i,a,o,h,p=0;p<e.length;p++){var l=e[p],v=l.type;if(v===O)typeof l.value=="number"&&l.value<0?r.push("("+l.value+")"):Array.isArray(l.value)?r.push("["+l.value.map(ce).join(", ")+"]"):r.push(ce(l.value));else if(v===j)n=r.pop(),s=r.pop(),a=l.value,t?a==="^"?r.push("Math.pow("+s+", "+n+")"):a==="and"?r.push("(!!"+s+" && !!"+n+")"):a==="or"?r.push("(!!"+s+" || !!"+n+")"):a==="||"?r.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+s+"),("+n+")))"):a==="=="?r.push("("+s+" === "+n+")"):a==="!="?r.push("("+s+" !== "+n+")"):a==="["?r.push(s+"[("+n+") | 0]"):r.push("("+s+" "+a+" "+n+")"):a==="["?r.push(s+"["+n+"]"):r.push("("+s+" "+a+" "+n+")");else if(v===J)if(i=r.pop(),n=r.pop(),s=r.pop(),a=l.value,a==="?")r.push("("+s+" ? "+n+" : "+i+")");else throw new Error("invalid Expression");else if(v===m||v===C)r.push(l.value);else if(v===G)s=r.pop(),a=l.value,a==="-"||a==="+"?r.push("("+a+s+")"):t?a==="not"?r.push("(!"+s+")"):a==="!"?r.push("fac("+s+")"):r.push(a+"("+s+")"):a==="!"?r.push("("+s+"!)"):r.push("("+a+" "+s+")");else if(v===U){for(h=l.value,o=[];h-- >0;)o.unshift(r.pop());a=r.pop(),r.push(a+"("+o.join(", ")+")")}else if(v===X){for(n=r.pop(),h=l.value,o=[];h-- >0;)o.unshift(r.pop());s=r.pop(),t?r.push("("+s+" = function("+o.join(", ")+") { return "+n+" })"):r.push("("+s+"("+o.join(", ")+") = "+n+")")}else if(v===N)s=r.pop(),r.push(s+"."+l.value);else if(v===B){for(h=l.value,o=[];h-- >0;)o.unshift(r.pop());r.push("["+o.join(", ")+"]")}else if(v===x)r.push("("+oe(l.value,t)+")");else if(v!==K)throw new Error("invalid Expression")}return r.length>1&&(t?r=[r.join(",")]:r=[r.join(";")]),String(r[0])}function ce(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function _(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function ue(e,t,r){r=r||{};for(var s=!!r.withMembers,n=null,i=0;i<e.length;i++){var a=e[i];a.type===m||a.type===C?!s&&!_(t,a.value)?t.push(a.value):(n!==null&&(_(t,n)||t.push(n)),n=a.value):a.type===N&&s&&n!==null?n+="."+a.value:a.type===x?ue(a.value,t,r):n!==null&&(_(t,n)||t.push(n),n=null)}n!==null&&!_(t,n)&&t.push(n)}function k(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}k.prototype.simplify=function(e){return e=e||{},new k(ne(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)};k.prototype.substitute=function(e,t){return t instanceof k||(t=this.parser.parse(String(t))),new k(Oe(this.tokens,e,t),this.parser)};k.prototype.evaluate=function(e){return e=e||{},P(this.tokens,this,e)};k.prototype.toString=function(){return oe(this.tokens,!1)};k.prototype.symbols=function(e){e=e||{};var t=[];return ue(this.tokens,t,e),t};k.prototype.variables=function(e){e=e||{};var t=[];ue(this.tokens,t,e);var r=this.functions;return t.filter(function(s){return!(s in r)})};k.prototype.toJSFunction=function(e,t){var r=this,s=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+oe(this.simplify(t).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var H="TEOF",y="TOP",Q="TNUMBER",ke="TSTRING",T="TPAREN",q="TBRACKET",ee="TCOMMA",he="TNAME",pe="TSEMICOLON";function be(e,t,r){this.type=e,this.value=t,this.index=r}be.prototype.toString=function(){return this.type+": "+this.value};function w(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}w.prototype.newToken=function(e,t,r){return new be(e,t,r??this.pos)};w.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current};w.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent};w.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(H,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};w.prototype.isString=function(){var e=!1,t=this.pos,r=this.expression.charAt(t);if(r==="'"||r==='"')for(var s=this.expression.indexOf(r,t+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,this.expression.charAt(s-1)!=="\\"){var n=this.expression.substring(t+1,s);this.current=this.newToken(ke,this.unescape(n),t),e=!0;break}s=this.expression.indexOf(r,s+1)}return e};w.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return e==="("||e===")"?(this.current=this.newToken(T,e),this.pos++,!0):!1};w.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return(e==="["||e==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(q,e),this.pos++,!0):!1};w.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return e===","?(this.current=this.newToken(ee,","),this.pos++,!0):!1};w.prototype.isSemicolon=function(){var e=this.expression.charAt(this.pos);return e===";"?(this.current=this.newToken(pe,";"),this.pos++,!0):!1};w.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&r!=="."&&(r<"0"||r>"9")))break}if(t>e){var s=this.expression.substring(e,t);if(s in this.consts)return this.current=this.newToken(Q,this.consts[s]),this.pos+=s.length,!0}return!1};w.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&(r<"0"||r>"9")))break}if(t>e){var s=this.expression.substring(e,t);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(y,s),this.pos+=s.length,!0}return!1};w.prototype.isName=function(){for(var e=this.pos,t=e,r=!1;t<this.expression.length;t++){var s=this.expression.charAt(t);if(s.toUpperCase()===s.toLowerCase()){if(t===this.pos&&(s==="$"||s==="_")){s==="_"&&(r=!0);continue}else if(t===this.pos||!r||s!=="_"&&(s<"0"||s>"9"))break}else r=!0}if(r){var n=this.expression.substring(e,t);return this.current=this.newToken(he,n),this.pos+=n.length,!0}return!1};w.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(e=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var Re=/^[0-9a-f]{4}$/i;w.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var r=e.substring(0,t);t>=0;){var s=e.charAt(++t);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;case"u":var n=e.substring(t+1,t+5);Re.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++t;var i=e.indexOf("\\",t);r+=e.substring(t,i<0?e.length:i),t=i}return r};w.prototype.isComment=function(){var e=this.expression.charAt(this.pos);return e==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1};w.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||this.expression.charAt(e)!=="0")return!1;++e;var t,r;if(this.expression.charAt(e)==="x")t=16,r=/^[0-9a-f]$/i,++e;else if(this.expression.charAt(e)==="b")t=2,r=/^[01]$/i,++e;else return!1;for(var s=!1,n=e;e<this.expression.length;){var i=this.expression.charAt(e);if(r.test(i))e++,s=!0;else break}return s&&(this.current=this.newToken(Q,parseInt(this.expression.substring(n,e),t)),this.pos=e),s};w.prototype.isNumber=function(){for(var e=!1,t=this.pos,r=t,s=t,n=!1,i=!1,a;t<this.expression.length&&(a=this.expression.charAt(t),a>="0"&&a<="9"||!n&&a===".");)a==="."?n=!0:i=!0,t++,e=i;if(e&&(s=t),a==="e"||a==="E"){t++;for(var o=!0,h=!1;t<this.expression.length;){if(a=this.expression.charAt(t),o&&(a==="+"||a==="-"))o=!1;else if(a>="0"&&a<="9")h=!0,o=!1;else break;t++}h||(t=s)}return e?(this.current=this.newToken(Q,parseFloat(this.expression.substring(r,t))),this.pos=t):this.pos=s,e};w.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(y,t);else if(t==="∙"||t==="•")this.current=this.newToken(y,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(y,">="),this.pos++):this.current=this.newToken(y,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(y,"<="),this.pos++):this.current=this.newToken(y,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(y,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(y,"=="),this.pos++):this.current=this.newToken(y,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(y,"!="),this.pos++):this.current=this.newToken(y,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=e,!1)};w.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)};w.prototype.getCoordinates=function(){var e=0,t,r=-1;do e++,t=this.pos-r,r=this.expression.indexOf(`
`,r+1);while(r>=0&&r<this.pos);return{line:e,column:t}};w.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)};function d(e,t,r){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=r.allowMemberAccess!==!1}d.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()};d.prototype.tokenMatches=function(e,t){return typeof t>"u"?!0:Array.isArray(t)?_(t,e.value):typeof t=="function"?t(e):e.value===t};d.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()};d.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken};d.prototype.accept=function(e,t){return this.nextToken.type===e&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1};d.prototype.expect=function(e,t){if(!this.accept(e,t)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(t||e))}};d.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;function r(n){return n.value in t}if(this.accept(he)||this.accept(y,r))e.push(new f(m,this.current.value));else if(this.accept(Q))e.push(new f(O,this.current.value));else if(this.accept(ke))e.push(new f(O,this.current.value));else if(this.accept(T,"("))this.parseExpression(e),this.expect(T,")");else if(this.accept(q,"["))if(this.accept(q,"]"))e.push(new f(B,0));else{var s=this.parseArrayList(e);e.push(new f(B,s))}else throw new Error("unexpected "+this.nextToken)};d.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(e,t)&&this.pushExpression(e,t))};d.prototype.pushExpression=function(e,t){for(var r=0,s=t.length;r<s;r++)e.push(t[r])};d.prototype.parseUntilEndStatement=function(e,t){return this.accept(pe)?(this.nextToken&&this.nextToken.type!==H&&!(this.nextToken.type===T&&this.nextToken.value===")")&&t.push(new f(K)),this.nextToken.type!==H&&this.parseExpression(t),e.push(new f(x,t)),!0):!1};d.prototype.parseArrayList=function(e){for(var t=0;!this.accept(q,"]");)for(this.parseExpression(e),++t;this.accept(ee);)this.parseExpression(e),++t;return t};d.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(y,"=");){var t=e.pop(),r=[],s=e.length-1;if(t.type===U){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,i=t.value+1;n<i;n++){var a=s-n;e[a].type===m&&(e[a]=new f(C,e[a].value))}this.parseVariableAssignmentExpression(r),e.push(new f(x,r)),e.push(new f(X,t.value));continue}if(t.type!==m&&t.type!==N)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),e.push(new f(C,t.value)),e.push(new f(x,r)),e.push(S("="))}};d.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(y,"?");){var t=[],r=[];this.parseConditionalExpression(t),this.expect(y,":"),this.parseConditionalExpression(r),e.push(new f(x,t)),e.push(new f(x,r)),e.push(Ae("?"))}};d.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(y,"or");){var t=[];this.parseAndExpression(t),e.push(new f(x,t)),e.push(S("or"))}};d.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(y,"and");){var t=[];this.parseComparison(t),e.push(new f(x,t)),e.push(S("and"))}};var De=["==","!=","<","<=",">=",">","in"];d.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(y,De);){var t=this.current;this.parseAddSub(e),e.push(S(t.value))}};var Fe=["+","-","||"];d.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(y,Fe);){var t=this.current;this.parseTerm(e),e.push(S(t.value))}};var _e=["*","/","%"];d.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(y,_e);){var t=this.current;this.parseFactor(e),e.push(S(t.value))}};d.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;function r(n){return n.value in t}if(this.save(),this.accept(y,r)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===T&&this.nextToken.value==="("){this.restore(),this.parseExponential(e);return}else if(this.nextToken.type===pe||this.nextToken.type===ee||this.nextToken.type===H||this.nextToken.type===T&&this.nextToken.value===")"){this.restore(),this.parseAtom(e);return}}var s=this.current;this.parseFactor(e),e.push(Z(s.value))}else this.parseExponential(e)};d.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(y,"^");)this.parseFactor(e),e.push(S("^"))};d.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(y,"!");)e.push(Z("!"))};d.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;function r(i){return i.value in t}if(this.accept(y,r)){var s=this.current;this.parseAtom(e),e.push(Z(s.value))}else for(this.parseMemberExpression(e);this.accept(T,"(");)if(this.accept(T,")"))e.push(new f(U,0));else{var n=this.parseArgumentList(e);e.push(new f(U,n))}};d.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(T,")");)for(this.parseExpression(e),++t;this.accept(ee);)this.parseExpression(e),++t;return t};d.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(y,".")||this.accept(q,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(he),e.push(new f(N,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(q,"]"),e.push(S("["))}else throw new Error("unexpected symbol: "+t.value)}};function Ue(e,t){return Number(e)+Number(t)}function Be(e,t){return e-t}function qe(e,t){return e*t}function Ge(e,t){return e/t}function je(e,t){return e%t}function Je(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function $e(e,t){return e===t}function Ve(e,t){return e!==t}function He(e,t){return e>t}function Ye(e,t){return e<t}function ze(e,t){return e>=t}function We(e,t){return e<=t}function Xe(e,t){return!!(e&&t)}function Ke(e,t){return!!(e||t)}function Ze(e,t){return _(t,e)}function Qe(e){return(Math.exp(e)-Math.exp(-e))/2}function et(e){return(Math.exp(e)+Math.exp(-e))/2}function tt(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function rt(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function st(e){return Math.log(e+Math.sqrt(e*e-1))}function nt(e){return Math.log((1+e)/(1-e))/2}function ve(e){return Math.log(e)*Math.LOG10E}function it(e){return-e}function at(e){return!e}function ot(e){return e<0?Math.ceil(e):Math.floor(e)}function ut(e){return Math.random()*(e||1)}function ye(e){return le(e+1)}function ht(e){return isFinite(e)&&e===Math.round(e)}var pt=4.7421875,re=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function le(e){var t,r;if(ht(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var s=e-2,n=e-1;s>1;)n*=s,s--;return n===0&&(n=1),n}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*le(1-e));if(e>=171.35)return 1/0;if(e>85){var i=e*e,a=i*e,o=a*e,h=o*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*i)-139/(51840*a)-571/(2488320*o)+163879/(209018880*h)+5246819/(75246796800*h*e))}--e,r=re[0];for(var p=1;p<re.length;++p)r+=re[p]/(e+p);return t=e+pt+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*r}function lt(e){return Array.isArray(e)?e.length:String(e).length}function de(){for(var e=0,t=0,r=0;r<arguments.length;r++){var s=Math.abs(arguments[r]),n;t<s?(n=t/s,e=e*n*n+1,t=s):s>0?(n=s/t,e+=n*n):e+=s}return t===1/0?1/0:t*Math.sqrt(e)}function we(e,t,r){return e?t:r}function ft(e,t){return typeof t>"u"||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||!(typeof t=="number"&&t%1===0)?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function ct(e,t,r){return r&&(r[e]=t),t}function vt(e,t){return e[t|0]}function yt(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function dt(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function wt(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(r,s){return e(r,s)})}function gt(e,t,r){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce(function(s,n,i){return e(s,n,i)},t)}function Et(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(r,s){return e(r,s)})}function Mt(e,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function xt(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function At(e){return(e>0)-(e<0)||+e}var ge=1/3;function Ot(e){return e<0?-Math.pow(-e,ge):Math.pow(e,ge)}function kt(e){return Math.exp(e)-1}function bt(e){return Math.log(1+e)}function mt(e){return Math.log(e)/Math.LN2}function R(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||Qe,cosh:Math.cosh||et,tanh:Math.tanh||tt,asinh:Math.asinh||rt,acosh:Math.acosh||st,atanh:Math.atanh||nt,sqrt:Math.sqrt,cbrt:Math.cbrt||Ot,log:Math.log,log2:Math.log2||mt,ln:Math.log,lg:Math.log10||ve,log10:Math.log10||ve,expm1:Math.expm1||kt,log1p:Math.log1p||bt,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||ot,"-":it,"+":Number,exp:Math.exp,not:at,length:lt,"!":ye,sign:Math.sign||At},this.binaryOps={"+":Ue,"-":Be,"*":qe,"/":Ge,"%":je,"^":Math.pow,"||":Je,"==":$e,"!=":Ve,">":He,"<":Ye,">=":ze,"<=":We,and:Xe,or:Ke,in:Ze,"=":ct,"[":vt},this.ternaryOps={"?":we},this.functions={random:ut,fac:ye,min:dt,max:yt,hypot:Math.hypot||de,pyt:Math.hypot||de,pow:Math.pow,atan2:Math.atan2,if:we,gamma:le,roundTo:ft,map:wt,fold:gt,filter:Et,indexOf:Mt,join:xt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}R.prototype.parse=function(e){var t=[],r=new d(this,new w(this,e),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(t),r.expect(H,"EOF"),new k(t,this)};R.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var me=new R;R.parse=function(e){return me.parse(e)};R.evaluate=function(e,t){return me.parse(e).evaluate(t)};var Ee={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function Tt(e){return Ee.hasOwnProperty(e)?Ee[e]:e}R.prototype.isOperatorEnabled=function(e){var t=Tt(e),r=this.options.operators||{};return!(t in r)||!!r[t]};async function W(){var t,r;const e=[];for(let s of document.querySelectorAll("tr[id*='stylesonlayer_set-']")){const n=(t=s.querySelector("select[id*='-style']"))==null?void 0:t.value,i=(r=s.querySelector("textarea[id*='feature_mapping']"))==null?void 0:r.value;if(!(n&&i))continue;const a=await Te(n);a!==null&&e.push({style:a,feature_mapping:i,inlineRow:s})}return{type:"Style",newStylesOnLayers:e}}async function Me(e){const t={type:"MapData",newGeoJsonData:null},r=e.title;if(r===null||r==="")return t;const s=await Se(r);if(s===null)return t;const n=JSON.parse(s.geojson);return n.features===null||n.features===void 0?t:{type:"MapData",newGeoJsonData:n}}const xe={styles:{addEventListener:e=>{const t=document.getElementById("stylesonlayer_set-group");t!==null&&new MutationObserver(s=>{s.forEach(n=>{n.target instanceof HTMLSelectElement&&n.type==="childList"&&e(n)})}).observe(t,{childList:!0,subtree:!0})}},featureMappings:{addEventListener:e=>{document.addEventListener("input",t=>{const r=t.target;r instanceof HTMLTextAreaElement&&r.id.includes("feature_mapping")&&e(t)})}}};function se(e,t){const r=new R;let s=[];for(let n of t){const i=n.inlineRow.querySelector("td[class*='feature_mapping']"),a=i==null?void 0:i.querySelector("div[id*='errors']");try{r.parse(n.feature_mapping).evaluate(Ce(e.properties))===!0&&(s.push(n.style),a&&i&&i.removeChild(a))}catch(o){if(a&&i&&i.removeChild(a),i&&!(i!=null&&i.querySelector("div[id*='errors']"))){const h=document.createElement("div");h.textContent=String(o),h.id="errors",h.style="color:rgb(255, 0, 0);",i.insertBefore(h,i.children[0])}}}return s}function F(e,t,r){if(t.currentLayer!==null&&e.removeLayer(t.currentLayer),r.type==="MapData"){const p=r.newGeoJsonData;p===null?t.currentLayer=null:(t.currentLayer=L.geoJSON(p),e.fitBounds(t.currentLayer.getBounds()))}else r.type==="Style"&&(t.stylesOnLayer=r.newStylesOnLayers);if(t.currentLayer===null)return;const s=p=>{let l=se(p,t.stylesOnLayer),v=!1,u=!1,c,g,M,A,$,Y,D="",V,I="round",z="round";for(let E of l)E.drawFill===!0&&(v=!0),E.drawStroke===!0&&(u=!0),E.drawMarker,c=te(c,E.fillOpacity),g=te(g,E.strokeOpacity),$=te($,E.strokeWeight),M===void 0?M=E.fillColor:M=fe(M,E.fillColor,.5),A===void 0?A=E.strokeColor:A=fe(A,E.strokeColor,.5),E.markerIcon!==""&&E.markerIcon,E.strokeDashArray!==null&&(D=E.strokeDashArray),E.strokeDashOffset!==null&&(V=E.strokeDashOffset),z=E.strokeLineJoin,I=E.strokeLineCap;return{fill:v,fillColor:M,fillOpacity:c,stroke:u,weight:$,opacity:g,color:A,dashArray:D,dashOffset:V,lineCap:I,lineJoin:z}},n=32,i=26,a=Le("injected-media-url").innerHTML,o=t.stylesOnLayer.filter(p=>p.style.drawMarker==!0).length>0,h=L.geoJSON(t.currentLayer.toGeoJSON(),{style:s,onEachFeature:(p,l)=>{if(p.geometry.type.toUpperCase().includes("POLYGON")&&o){const u=p,g=se(p,t.stylesOnLayer).filter(M=>M.drawMarker==!0);if(g.length>0){g[0];for(let M of u.geometry.coordinates){const A=Pe(M);console.log(A)}}}},pointToLayer:function(p,l){let v=null;const u=se(p,t.stylesOnLayer);for(let c of u)if(c.drawMarker&&c.markerIcon.trimStart().trimEnd()!==""){v=c;break}return v===null?L.marker(l):L.marker(l,{icon:L.divIcon({html:`
                        <div 
                            style="
                                width: ${n}px;
                                height: ${n}px;
                                background-color: ${v.markerBackgroundColor};
                                opacity: ${v.markerIconOpacity};
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            "
                        >
                            <img 
                                src="${a+v.markerIcon}"
                                style="
                                    width: ${i}px; 
                                    height: ${i}px;
                                "
                            />
                        <div/>
                    `,className:"",iconSize:[n,n],iconAnchor:[n/2,n/2]})})}});t.currentLayer=h,h.addTo(e)}document.addEventListener("DOMContentLoaded",()=>{(async()=>{const e={minZoom:0,maxZoom:22,updateWhenIdle:!0,zIndex:0,attribution:'© <a href="https://www.mapbox.com/about/maps/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>'},t="rushadmin",r="clw2m6f9b018001obfxcc747g",s="pk.eyJ1IjoicnVzaGFkbWluIiwiYSI6ImNsdzJtYmRydzBuNDIyam5yZ2pwMG16cnUifQ.SkSSdHcrPq4u8HSitBvJcg",n="https://api.mapbox.com/styles/v1/",i=`${t}/${r}/tiles/256/{z}/{x}/{y}@2x`,a=`?access_token=${s}`;let o=L.map("map-preview").setView([0,0],2);L.tileLayer(n+i+a,e).addTo(o);let h={stylesOnLayer:[],currentLayer:null},p=!1;xe.featureMappings.addEventListener(()=>p=!0);const l=()=>{p===!0&&W().then(g=>{F(o,h,g)}),p=!1,setTimeout(l,1e3)};setTimeout(l,1e3),xe.styles.addEventListener(()=>{W().then(g=>{F(o,h,g)})}),document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"&&W().then(g=>{F(o,h,g)})});const u=await Ie("select2-id_map_data-container");new MutationObserver(g=>{g.forEach(M=>{M.type==="childList"&&Me(u).then(A=>F(o,h,A))})}).observe(u,{childList:!0}),Promise.all([W(),Me(u)]).then(([g,M])=>{F(o,h,M),F(o,h,g)})})()});
